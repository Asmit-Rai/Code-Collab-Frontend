{"ast":null,"code":"import React,{useState,useRef,useEffect}from\"react\";import toast from\"react-hot-toast\";import ACTIONS from\"../Actions\";import Client from\"../components/Client\";import Editor from\"../components/Editor\";import{initSocket}from\"../socket\";import{useLocation,useNavigate,Navigate,useParams}from\"react-router-dom\";import Compiler from\"../components/Compiler\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const EditorPage=()=>{const socketRef=useRef(null);const codeRef=useRef(\"\");const location=useLocation();const{roomId}=useParams();const reactNavigator=useNavigate();const[clients,setClients]=useState([]);const[code,setCode]=useState(localStorage.getItem(\"input\")||\"\");const[copiedCode,setCopiedCode]=useState(\"\");const handleCodeChange=newCode=>{setCode(newCode);};const passCodeToCompiler=()=>{setCode(codeRef.current);};const copyToCompiler=()=>{setCopiedCode(codeRef.current);};useEffect(()=>{const init=async()=>{var _location$state;socketRef.current=await initSocket();socketRef.current.on(\"connect_error\",err=>handleErrors(err));socketRef.current.on(\"connect_failed\",err=>handleErrors(err));function handleErrors(e){console.log(\"socket error\",e);toast.error(\"Socket connection failed, try again later.\");reactNavigator(\"/\");}socketRef.current.emit(ACTIONS.JOIN,{roomId,username:(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.username});socketRef.current.on(ACTIONS.JOINED,_ref=>{var _location$state2;let{clients,username,socketId}=_ref;if(username!==((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.username)){toast.success(`${username} joined the room.`);console.log(`${username} joined`);}setClients(clients);socketRef.current.emit(ACTIONS.SYNC_CODE,{code:codeRef.current,socketId});});socketRef.current.on(ACTIONS.DISCONNECTED,_ref2=>{let{socketId,username}=_ref2;toast.success(`${username} left the room.`);setClients(prev=>{return prev.filter(client=>client.socketId!==socketId);});});};init();return()=>{};},[]);async function copyRoomId(){try{await navigator.clipboard.writeText(roomId);toast.success(\"Room ID has been copied to your clipboard\");}catch(err){toast.error(\"Could not copy the Room ID\");console.error(err);}}function leaveRoom(){reactNavigator(\"/\");}if(!location.state){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"mainWrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"aside\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"asideInner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(\"img\",{className:\"logoImage\",src:\"/code-sync.png\",alt:\"logo\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Connected\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clientsList\",children:clients.map(client=>/*#__PURE__*/_jsx(Client,{username:client.username},client.socketId))})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn copyBtn\",onClick:copyRoomId,children:\"Copy ROOM ID\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn leaveBtn\",onClick:leaveRoom,children:\"Leave\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"editorWrap\",children:/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,roomId:roomId,onCodeChange:handleCodeChange})}),/*#__PURE__*/_jsx(\"div\",{className:\"editorWrap\",children:/*#__PURE__*/_jsx(Compiler,{code:code,copiedCode:copiedCode})})]});};export default EditorPage;","map":{"version":3,"names":["React","useState","useRef","useEffect","toast","ACTIONS","Client","Editor","initSocket","useLocation","useNavigate","Navigate","useParams","Compiler","jsx","_jsx","jsxs","_jsxs","EditorPage","socketRef","codeRef","location","roomId","reactNavigator","clients","setClients","code","setCode","localStorage","getItem","copiedCode","setCopiedCode","handleCodeChange","newCode","passCodeToCompiler","current","copyToCompiler","init","_location$state","on","err","handleErrors","e","console","log","error","emit","JOIN","username","state","JOINED","_ref","_location$state2","socketId","success","SYNC_CODE","DISCONNECTED","_ref2","prev","filter","client","copyRoomId","navigator","clipboard","writeText","leaveRoom","to","className","children","src","alt","map","onClick","onCodeChange"],"sources":["C:/Users/asmit rai/Work Space/Projects/CodeCollab/code-collab/src/pages/EditorPage.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport toast from \"react-hot-toast\";\nimport ACTIONS from \"../Actions\";\nimport Client from \"../components/Client\";\nimport Editor from \"../components/Editor\";\nimport { initSocket } from \"../socket\";\nimport {\n  useLocation,\n  useNavigate,\n  Navigate,\n  useParams,\n} from \"react-router-dom\";\nimport Compiler from \"../components/Compiler\";\n\nconst EditorPage = () => {\n  const socketRef = useRef(null);\n  const codeRef = useRef(\"\");\n  const location = useLocation();\n  const { roomId } = useParams();\n  const reactNavigator = useNavigate();\n  const [clients, setClients] = useState([]);\n  const [code, setCode] = useState(localStorage.getItem(\"input\") || \"\");\n  const [copiedCode, setCopiedCode] = useState(\"\");\n\n  const handleCodeChange = (newCode) => {\n    setCode(newCode);\n  };\n\n  const passCodeToCompiler = () => {\n    setCode(codeRef.current);\n  };\n\n  const copyToCompiler = () => {\n    setCopiedCode(codeRef.current);\n  };\n\n  useEffect(() => {\n    const init = async () => {\n      socketRef.current = await initSocket();\n      socketRef.current.on(\"connect_error\", (err) => handleErrors(err));\n      socketRef.current.on(\"connect_failed\", (err) => handleErrors(err));\n\n      function handleErrors(e) {\n        console.log(\"socket error\", e);\n        toast.error(\"Socket connection failed, try again later.\");\n        reactNavigator(\"/\");\n      }\n\n      socketRef.current.emit(ACTIONS.JOIN, {\n        roomId,\n        username: location.state?.username,\n      });\n\n      socketRef.current.on(\n        ACTIONS.JOINED,\n        ({ clients, username, socketId }) => {\n          if (username !== location.state?.username) {\n            toast.success(`${username} joined the room.`);\n            console.log(`${username} joined`);\n          }\n          setClients(clients);\n          socketRef.current.emit(ACTIONS.SYNC_CODE, {\n            code: codeRef.current,\n            socketId,\n          });\n        }\n      );\n\n      socketRef.current.on(ACTIONS.DISCONNECTED, ({ socketId, username }) => {\n        toast.success(`${username} left the room.`);\n        setClients((prev) => {\n          return prev.filter((client) => client.socketId !== socketId);\n        });\n      });\n    };\n    init();\n    return () => {};\n  }, []);\n\n  async function copyRoomId() {\n    try {\n      await navigator.clipboard.writeText(roomId);\n      toast.success(\"Room ID has been copied to your clipboard\");\n    } catch (err) {\n      toast.error(\"Could not copy the Room ID\");\n      console.error(err);\n    }\n  }\n\n  function leaveRoom() {\n    reactNavigator(\"/\");\n  }\n\n  if (!location.state) {\n    return <Navigate to=\"/\" />;\n  }\n\n  return (\n    <div className=\"mainWrap\">\n      <div className=\"aside\">\n        <div className=\"asideInner\">\n          <div className=\"logo\">\n            <img className=\"logoImage\" src=\"/code-sync.png\" alt=\"logo\" />\n          </div>\n          <h3>Connected</h3>\n          <div className=\"clientsList\">\n            {clients.map((client) => (\n              <Client key={client.socketId} username={client.username} />\n            ))}\n          </div>\n        </div>\n        <button className=\"btn copyBtn\" onClick={copyRoomId}>\n          Copy ROOM ID\n        </button>\n        <button className=\"btn leaveBtn\" onClick={leaveRoom}>\n          Leave\n        </button>\n      </div>\n\n      <div className=\"editorWrap\">\n        <Editor\n          socketRef={socketRef}\n          roomId={roomId}\n          onCodeChange={handleCodeChange}\n        />\n      </div>\n      <div className=\"editorWrap\">\n        <Compiler code={code} copiedCode={copiedCode} />\n      </div>\n    </div>\n  );\n};\n\nexport default EditorPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}